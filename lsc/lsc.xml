<?xml version="1.0"?>
<lsc xmlns="http://lsc-project.org/XSD/lsc-core-2.1.xsd" xmlns:fusiondirectory="http://lsc-project.org/XSD/lsc-fusiondirectory-plugin-1.0.xsd" xmlns:exec="http://lsc-project.org/XSD/lsc-executable-plugin-1.0.xsd">
  <connections>
<!--    <pluginConnection>
      <name>fusiondirectory</name>
      <url>http://10.0.2.4/rest.php/v1</url>
      <username>fd-admin</username>
      <password>fd-admin</password>
    </pluginConnection> -->
    <ldapConnection>
      <name>openldap</name>
      <url>ldap://10.0.2.4:389/dc=demo,dc=fusion</url>
      <username>cn=admin,dc=demo,dc=fusion</username>
      <password>passldap</password>
      <authentication>SIMPLE</authentication>
    </ldapConnection>

    <pluginConnection>
      <name>executable</name>
      <url>fake</url>
      <username>fake</username>
      <password>fake</password>
    </pluginConnection>
  </connections>
  <tasks>
    <task>
      <name>Users</name>
      <bean>org.lsc.beans.SimpleBean</bean>
      <ldapSourceService>
        <name>openldap-source-service</name>
        <connection reference="openldap" />
        <baseDn>dc=demo,dc=fusion</baseDn>
        <pivotAttributes>
          <string>uid</string>
        </pivotAttributes>
        <fetchedAttributes>
          <string>uid</string>
          <string>supannAliasLogin</string>
          <string>description</string>
          <string>mail</string>
          <string>employeeNumber</string>
          <string>cn</string>
          <string>supannCMSId;x-mifare-xlsb</string>
          <string>ou</string>
          <string>roomNumber</string>
          <string>employeNumber</string>
          <string>displayName</string>
        </fetchedAttributes>
        <getAllFilter><![CDATA[(&(objectClass=inetOrgPerson)(supannListeRouge=TRUE))]]></getAllFilter>
        <getOneFilter><![CDATA[(&(objectClass=inetOrgPerson)(uid={uid}))]]></getOneFilter>
        <cleanFilter><![CDATA[(&(objectClass=inetOrgPerson)(uid={uid}))]]></cleanFilter>
      </ldapSourceService>
<!--      <pluginSourceService implementationClass="org.lsc.plugins.connectors.fusiondirectory.FusionDirectorySrcService">
        <name>fusiondirectorysrcservice</name>
        <connection reference="fusiondirectory"/>
        <fusiondirectory:fusionDirectoryServiceSettings>
          <name>fusiondirectory-service-settings</name>
          <connection reference="fusiondirectory"/>
          <fusiondirectory:entity>USER</fusiondirectory:entity>
          <fusiondirectory:pivot>uid</fusiondirectory:pivot>
          <fusiondirectory:filter>uid=*</fusiondirectory:filter>
          <fusiondirectory:attributes>
            <fusiondirectory:tab name="user">
              <string>uid</string>
              <string>cn</string>
              <string>sn</string>
              <string>givenName</string>
              <string>description</string>
              <string>title</string>
            </fusiondirectory:tab>
            <fusiondirectory:tab name="mailAccount">
              <string>mail</string>
            </fusiondirectory:tab>
          </fusiondirectory:attributes>
        </fusiondirectory:fusionDirectoryServiceSettings>
      </pluginSourceService> -->
      <pluginDestinationService implementationClass="org.lsc.plugins.connectors.executable.ExecutableLdifDestinationService">
        <name>user-dst-service</name>
        <connection reference="executable"/>
        <exec:executableLdifDestinationServiceSettings>
          <name>user-dst-service-exec</name>
          <connection reference="executable"/>
          <exec:listScript>/srv/lsc-script-papercut/list.sh</exec:listScript>
          <exec:getScript>/srv/lsc-script-papercut/get.sh</exec:getScript>
          <exec:addScript>/srv/lsc-script-papercut/add.sh</exec:addScript>
          <exec:updateScript>/srv/lsc-script-papercut/update.sh</exec:updateScript>
          <exec:removeScript>/srv/lsc-script-papercut/remove.sh</exec:removeScript>
          <exec:renameScript/>
          <exec:variables>
            <entry>
              <key>LSC_PC_BIN_PATH</key>
              <value>/srv/lsc-script-papercut/</value>
            </entry>
            <entry>
              <key>LSC_PC_LOG_FILE</key>
              <value>/tmp/log-file-from-env.log</value>
            </entry>
            <entry>
              <key>LSC_PC_URL</key>
              <value>http://10.0.2.16:9191/</value>
            </entry>
            <entry>
              <key>LSC_PC_TOKEN</key>
              <value>TestAPIKey</value>
            </entry>
            <entry>
              <key>LSC_PC_PIVOT</key>
              <value>uid</value>
            </entry>
            <entry>
              <key>LSC_PC_ATTRIBUTS</key>
              <value>card-number,card-pin,department,email,full-name,notes,office,username-alias,primary-card-number,secondary-card-number</value>
            </entry>
          </exec:variables>
          <exec:fetchedAttributes>
            <string>username-alias</string>
            <string>notes</string>
            <string>email</string>
<!--            <string>username</string> -->
            <string>full-name</string>
            <string>secondary-card-number</string>
            <string>primary-card-number</string>
            <string>office</string>
            <string>department</string>
          </exec:fetchedAttributes>
        </exec:executableLdifDestinationServiceSettings>
      </pluginDestinationService>
      <propertiesBasedSyncOptions>
        <mainIdentifier>srcBean.getMainIdentifier()</mainIdentifier>
        <defaultDelimiter>;</defaultDelimiter>
        <defaultPolicy>FORCE</defaultPolicy>
        <conditions>
          <create>true</create>
          <update>true</update>
          <delete>true</delete>
          <changeId>false</changeId>
        </conditions>
<!--        <dataset>
          <name>username</name>
          <policy>FORCE</policy>
          <forceValues>
            <string>srcBean.getDatasetFirstValueById("uid")</string>
          </forceValues>
        </dataset> -->

        <dataset>
          <name>username-alias</name>
          <policy>FORCE</policy>
          <forceValues>
            <string>srcBean.getDatasetFirstValueById("supannAliasLogin")</string>
          </forceValues>
        </dataset>
        <dataset>
          <name>email</name>
          <policy>FORCE</policy>
          <forceValues>
            <string>srcBean.getDatasetFirstValueById("mail")</string>
          </forceValues>
        </dataset>
        <dataset>
          <name>notes</name>
          <policy>FORCE</policy>
          <forceValues>
            <string>srcBean.getDatasetFirstValueById("description")</string>
          </forceValues>
        </dataset>
        <dataset>
          <name>full-name</name>
          <policy>FORCE</policy>
          <forceValues>
            <string>srcBean.getDatasetFirstValueById("displayName")</string>
          </forceValues>
        </dataset>
        <dataset>
          <name>secondary-card-number</name>
          <policy>FORCE</policy>
          <forceValues>
            <string>srcBean.getDatasetFirstValueById("supannCMSId;x-mifare-xlsb").toLowerCase()</string>
          </forceValues>
        </dataset>
        <dataset>
          <name>primary-card-number</name>
          <policy>FORCE</policy>
          <forceValues>
            <string>srcBean.getDatasetFirstValueById("employeeNumber").toLowerCase()</string>
          </forceValues>
        </dataset>
        <dataset>
          <name>office</name>
          <policy>FORCE</policy>
          <forceValues>
            <string>srcBean.getDatasetFirstValueById("roomNumber")</string>
          </forceValues>
        </dataset>
        <dataset>
          <name>department</name>
          <policy>FORCE</policy>
          <forceValues>
            <string>srcBean.getDatasetFirstValueById("ou")</string>
          </forceValues>
        </dataset>



      </propertiesBasedSyncOptions>
    </task>
  </tasks>
</lsc>
